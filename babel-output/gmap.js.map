{"version":3,"sources":["../src/gmap.js"],"names":["getPageData","url","page","goto","waitForSelector","shopName","$eval","name","textContent","reviewRating","rating","reviewCount","review","address","$$eval","divs","Array","from","map","div","innerText","find","undefined","timeout","ex","console","log","website","link","test","phone","returnObj","shop","trim","replace","latLong","getLatLong","getLinks","newScrollHeight","scrollHeight","divSelector","evaluate","document","querySelector","scrollTo","waitForTimeout","searchResults","querySelectorAll","el","href","filter","match","latLongStartIndex","indexOf","latLongEndIndex","substring","GMapScrapper","searchQuery","waitForNavigation","waitUntil","allLinks","elements","some","push","getAttribute","click","scrapedData","data","module","exports"],"mappings":";;AAAA;AACA;;AAEA;AACA,eAAeA,WAAf,CAA2BC,GAA3B,EAAgCC,IAAhC,EAAsC;AACrC,OAAMA,KAAKC,IAAL,CAAUF,GAAV,CAAN;;AAEA;AACA,OAAMC,KAAKE,eAAL,CAAqB,uCAArB,CAAN;AACA,OAAMC,WAAW,MAAMH,KAAKI,KAAL,CACtB,uCADsB,EAErBC,IAAD,IAAUA,KAAKC,WAFO,CAAvB;;AAKA,OAAMN,KAAKE,eAAL,CAAqB,yCAArB,CAAN;AACA,OAAMK,eAAe,MAAMP,KAAKI,KAAL,CAC1B,4DAD0B,EAEzBI,MAAD,IAAYA,OAAOF,WAFO,CAA3B;;AAKA,OAAMN,KAAKE,eAAL,CAAqB,yCAArB,CAAN;AACA,OAAMO,cAAc,MAAMT,KAAKI,KAAL,CACzB,sEADyB,EAExBM,MAAD,IAAYA,OAAOJ,WAFM,CAA1B;;AAKA;AACA,OAAMN,KAAKE,eAAL,CAAqB,qCAArB,CAAN;AACA,KAAIS,UAAU,MAAMX,KAAKY,MAAL,CACnB,sEADmB,EAElBC,IAAD,IACCC,MAAMC,IAAN,CAAWF,IAAX,EACEG,GADF,CACOC,GAAD,IAASA,IAAIC,SADnB,EAEEC,IAFF,CAEQR,OAAD,IAAaA,OAFpB,CAHkB,CAApB;;AAQA,KAAIA,YAAYS,SAAhB,EAA2B;AAC1BT,YAAU,MAAMX,KAAKY,MAAL,CACf,sEADe,EAEdC,IAAD,IAAUA,KAAK,CAAL,CAFK,CAAhB;AAIA;;AAED;AACA,KAAI;AACH,QAAMb,KAAKE,eAAL,CAAqB,SAArB,EAAgC,EAAEmB,SAAS,CAAX,EAAhC,CAAN;AACA,EAFD,CAEE,OAAOC,EAAP,EAAW;AACZC,UAAQC,GAAR,CAAY,mBAAZ;AACA;;AAED,OAAMC,UAAU,MAAMzB,KAAKY,MAAL,CACrB,sEADqB,EAEpBC,IAAD,IACCC,MAAMC,IAAN,CAAWF,IAAX,EACEG,GADF,CACOC,GAAD,IAASA,IAAIC,SADnB,EAEEC,IAFF,CAEQO,IAAD,IACL,4HAA4HC,IAA5H,CACCD,IADD,CAHF,CAHoB,CAAtB;;AAYA,OAAME,QAAQ,MAAM5B,KAAKY,MAAL;AACnB;AACA,0JAFmB,EAGlBC,IAAD,IACCC,MAAMC,IAAN,CAAWF,IAAX,EACEG,GADF,CACOC,GAAD,IAASA,IAAIC,SADnB,EAEEC,IAFF,CAEQS,KAAD,IAAWA,KAFlB,CAJkB,CAApB;;AASA,KAAIC,YAAY;AACfC,QAAM3B,SAAS4B,IAAT,EADS;AAEfxB,gBAAcA,aAAawB,IAAb,EAFC;AAGftB,eAAaA,YAAYsB,IAAZ,EAHE;AAIfpB,WAASA,QAAQoB,IAAR,EAJM;AAKfN,WAASA,QAAQM,IAAR,EALM;AAMfH,SAAOA,MAAMI,OAAN,CAAc,GAAd,EAAmB,EAAnB,EAAuBD,IAAvB,EANQ;AAOfE,WAAS,MAAMC,WAAWnC,GAAX;AAPA,EAAhB;;AAUAwB,SAAQC,GAAR,CAAYK,SAAZ;;AAEA,QAAOA,SAAP;AACA;AACA;;AAED;AACA,eAAeM,QAAf,CAAwBnC,IAAxB,EAA8B;AAC7B;AACA,KAAIoC,kBAAkB,CAAtB;AACA,KAAIC,eAAe,IAAnB;AACA,KAAIC,cAAc,wDAAlB;;AAEA,QAAO,IAAP,EAAa;AACZ,QAAMtC,KAAKE,eAAL,CAAqBoC,WAArB,CAAN;;AAEA,QAAMtC,KAAKuC,QAAL,CACL,CAACF,YAAD,EAAeC,WAAf,KACCE,SAASC,aAAT,CAAuBH,WAAvB,EAAoCI,QAApC,CAA6C,CAA7C,EAAgDL,YAAhD,CAFI,EAGLA,YAHK,EAILC,WAJK,CAAN;;AAOA,QAAMtC,KAAK2C,cAAL,CAAoB,GAApB,CAAN;;AAEAP,oBAAkB,MAAMpC,KAAKI,KAAL,CACvBkC,WADuB,EAEtBrB,GAAD,IAASA,IAAIoB,YAFU,CAAxB;;AAKA,MAAIA,iBAAiBD,eAArB,EAAsC;AACrC;AACA,GAFD,MAEO;AACNC,kBAAeD,eAAf;AACA;AACD;;AAED;AACA,OAAMQ,gBAAgB,MAAM5C,KAAKuC,QAAL,CAAc,MACzCzB,MAAMC,IAAN,CAAWyB,SAASK,gBAAT,CAA0B,GAA1B,CAAX,EACE7B,GADF,CACO8B,EAAD,IAAQA,GAAGC,IADjB,EAEEC,MAFF,CAGGtB,IAAD,IACCA,KAAKuB,KAAL,CAAW,mCAAX,EAAgDvB,IAAhD,KACA,CAACA,KAAKuB,KAAL,CAAW,qCAAX,EAAkDvB,IAAlD,CALJ,CAD2B,CAA5B;;AAUA,QAAOkB,aAAP;AACA;;AAED,eAAeV,UAAf,CAA0BnC,GAA1B,EAA+B;AAC9B,OAAMmD,oBAAoBnD,IAAIoD,OAAJ,CAAY,MAAZ,IAAsB,CAAhD;AACA,OAAMC,kBAAkBrD,IAAIoD,OAAJ,CAAY,GAAZ,CAAxB;;AAEA,QAAOpD,IAAIsD,SAAJ,CAAcH,iBAAd,EAAiCE,eAAjC,EAAkDpB,OAAlD,CAA0D,KAA1D,EAAiE,GAAjE,CAAP;AACA;;AAED,eAAesB,YAAf,CAA4BtD,IAA5B,EAAkCuD,cAAc,aAAhD,EAA+D;AAC9DhC,SAAQC,GAAR,CAAY,sBAAZ;;AAEA,OAAMxB,KAAKC,IAAL,CAAU,oCAAoCsD,WAA9C,CAAN;AACA,OAAMvD,KAAKwD,iBAAL,CAAuB,EAAEC,WAAW,kBAAb,EAAvB,CAAN;AACA,OAAMzD,KAAK2C,cAAL,CAAoB,IAApB,CAAN;;AAEA,KAAIe,WAAW,EAAf;;AAEA,QACC,EAAE,MAAM1D,KAAKY,MAAL,CACP,iDADO,EAEN+C,QAAD,IACC7C,MAAMC,IAAN,CAAW4C,QAAX,EAAqBC,IAArB,CACEd,EAAD,IAASA,GAAG5B,SAAH,KAAiB,uBAAjB,IAA4C4B,GAAG5B,SAAH,KAAiB,kBADvE,CAHM,CAAR,CADD,EAQE;AACDwC,WAASG,IAAT,CAAc,IAAI,MAAM1B,SAASnC,IAAT,CAAV,CAAd;;AAEA,QAAMA,KAAKY,MAAL,CAAY,QAAZ,EAAuB+C,QAAD,IAAc;AACzC,UAAO7C,MAAMC,IAAN,CAAW4C,QAAX,EACLxC,IADK,CACC2B,EAAD,IAAQA,GAAGgB,YAAH,CAAgB,YAAhB,MAAkC,oBAD1C,EAELC,KAFK,EAAP;AAGA,GAJK,CAAN;;AAMA,QAAM/D,KAAKwD,iBAAL,CAAuB,EAAEC,WAAW,MAAb,EAAvB,CAAN;AACA;;AAEDlC,SAAQC,GAAR,CAAYkC,QAAZ;;AAEA,OAAMM,cAAc,EAApB;;AAEA,MAAK,IAAItC,IAAT,IAAiBgC,QAAjB,EAA2B;AAC1B,QAAMO,OAAO,MAAMnE,YAAY4B,IAAZ,EAAkB1B,IAAlB,CAAnB;AACAgE,cAAYH,IAAZ,CAAiBI,IAAjB;AACA;;AAED1C,SAAQC,GAAR,CAAYwC,WAAZ;AACA;;AAEDE,OAAOC,OAAP,GAAiBb,YAAjB","file":"gmap.js","sourcesContent":["// const puppeteer = require(\"puppeteer\"); /// import puppeteer from \"puppeteer\";\n// const xlsx = require(\"xlsx\");\n\n// Get the data\nasync function getPageData(url, page) {\n\tawait page.goto(url);\n\n\t//Shop Name\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-title span\");\n\tconst shopName = await page.$eval(\n\t\t\".x3AX1-LfntMc-header-title-title span\",\n\t\t(name) => name.textContent\n\t);\n\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-ij8cu-haAclf\");\n\tconst reviewRating = await page.$eval(\n\t\t\".x3AX1-LfntMc-header-title-ij8cu-haAclf span > span > span\",\n\t\t(rating) => rating.textContent\n\t);\n\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-ij8cu-haAclf\");\n\tconst reviewCount = await page.$eval(\n\t\t\".x3AX1-LfntMc-header-title-ij8cu-haAclf span button.widget-pane-link\",\n\t\t(review) => review.textContent\n\t);\n\n\t//Shop Address\n\tawait page.waitForSelector(\".QSFF4-text.gm2-body-2:nth-child(1)\");\n\tlet address = await page.$$eval(\n\t\t\"#pane > div > div > div > div > div > div > button > div > div > div\",\n\t\t(divs) =>\n\t\t\tArray.from(divs)\n\t\t\t\t.map((div) => div.innerText)\n\t\t\t\t.find((address) => address)\n\t);\n\n\tif (address === undefined) {\n\t\taddress = await page.$$eval(\n\t\t\t\"#pane > div > div > div > div > div > div > button > div > div > div\",\n\t\t\t(divs) => divs[1]\n\t\t);\n\t}\n\n\t//Website\n\ttry {\n\t\tawait page.waitForSelector(\".HY5zDd\", { timeout: 3 });\n\t} catch (ex) {\n\t\tconsole.log('No element found.');\n\t}\n\n\tconst website = await page.$$eval(\n\t\t\"#pane > div > div > div > div > div > div > button > div > div > div\",\n\t\t(divs) =>\n\t\t\tArray.from(divs)\n\t\t\t\t.map((div) => div.innerText)\n\t\t\t\t.find((link) =>\n\t\t\t\t\t/^((https?|ftp|smtp):\\/\\/)?(www.)?[a-z0-9]+(\\.[a-z]{2,}){1,3}(#?\\/?[a-zA-Z0-9#]+)*\\/?(\\?[a-zA-Z0-9-_]+=[a-zA-Z0-9-%]+&?)?$/.test(\n\t\t\t\t\t\tlink\n\t\t\t\t\t)\n\t\t\t\t)\n\t);\n\n\tconst phone = await page.$$eval(\n\t\t// \"#pane > div > div.widget-pane-content.cYB2Ge-oHo7ed > div > div > div:nth-child(9) > div:nth-child(2) > button > div.AeaXub > div.rogA2c > div.QSFF4-text.gm2-body-2\",\n\t\t'#pane > div > div.widget-pane-content.cYB2Ge-oHo7ed > div > div > div:nth-child(9) > div > button[data-item-id^=\"phone:tel:\"] div.QSFF4-text.gm2-body-2',\n\t\t(divs) =>\n\t\t\tArray.from(divs)\n\t\t\t\t.map((div) => div.innerText)\n\t\t\t\t.find((phone) => phone)\n\t);\n\n\tlet returnObj = {\n\t\tshop: shopName.trim(),\n\t\treviewRating: reviewRating.trim(),\n\t\treviewCount: reviewCount.trim(),\n\t\taddress: address.trim(),\n\t\twebsite: website.trim(),\n\t\tphone: phone.replace('-', '').trim(),\n\t\tlatLong: await getLatLong(url),\n\t};\n\n\tconsole.log(returnObj);\n\n\treturn returnObj;\n\t//await browser.close();\n}\n\n//Get Links\nasync function getLinks(page) {\n\t// Scrolling to bottom of page\n\tlet newScrollHeight = 0;\n\tlet scrollHeight = 1000;\n\tlet divSelector = \"#pane > div > div > div > div > div:nth-child(4) > div\";\n\n\twhile (true) {\n\t\tawait page.waitForSelector(divSelector);\n\n\t\tawait page.evaluate(\n\t\t\t(scrollHeight, divSelector) =>\n\t\t\t\tdocument.querySelector(divSelector).scrollTo(0, scrollHeight),\n\t\t\tscrollHeight,\n\t\t\tdivSelector\n\t\t);\n\n\t\tawait page.waitForTimeout(300);\n\n\t\tnewScrollHeight = await page.$eval(\n\t\t\tdivSelector,\n\t\t\t(div) => div.scrollHeight\n\t\t);\n\n\t\tif (scrollHeight === newScrollHeight) {\n\t\t\tbreak;\n\t\t} else {\n\t\t\tscrollHeight = newScrollHeight;\n\t\t}\n\t}\n\n\t// Get results\n\tconst searchResults = await page.evaluate(() =>\n\t\tArray.from(document.querySelectorAll(\"a\"))\n\t\t\t.map((el) => el.href)\n\t\t\t.filter(\n\t\t\t\t(link) =>\n\t\t\t\t\tlink.match(/https:\\/\\/www.google.com\\/maps\\//g, link) &&\n\t\t\t\t\t!link.match(/\\=https:\\/\\/www.google.com\\/maps\\//g, link)\n\t\t\t)\n\t);\n\n\treturn searchResults;\n}\n\nasync function getLatLong(url) {\n\tconst latLongStartIndex = url.indexOf('!3d-') + 4;\n\tconst latLongEndIndex = url.indexOf('?');\n\n\treturn url.substring(latLongStartIndex, latLongEndIndex).replace('!4d', ':');\n}\n\nasync function GMapScrapper(page, searchQuery = \"flower shop\") {\n\tconsole.log('Star scrapping data.');\n\n\tawait page.goto(\"https://www.google.com/maps/?q=\" + searchQuery);\n\tawait page.waitForNavigation({ waitUntil: \"domcontentloaded\" });\n\tawait page.waitForTimeout(4000);\n\n\tlet allLinks = [];\n\n\twhile (\n\t\t!(await page.$$eval(\n\t\t\t\"#pane > div > div > div > div > div > div > div\",\n\t\t\t(elements) =>\n\t\t\t\tArray.from(elements).some(\n\t\t\t\t\t(el) => (el.innerText === \"Tidak ditemukan hasil\" || el.innerText === \"No results found\")\n\t\t\t\t)\n\t\t))\n\t) {\n\t\tallLinks.push(...(await getLinks(page)));\n\n\t\tawait page.$$eval(\"button\", (elements) => {\n\t\t\treturn Array.from(elements)\n\t\t\t\t.find((el) => el.getAttribute(\"aria-label\") === \"Halaman berikutnya\")\n\t\t\t\t.click()\n\t\t});\n\n\t\tawait page.waitForNavigation({ waitUntil: \"load\" });\n\t}\n\n\tconsole.log(allLinks);\n\n\tconst scrapedData = [];\n\n\tfor (let link of allLinks) {\n\t\tconst data = await getPageData(link, page);\n\t\tscrapedData.push(data);\n\t}\n\n\tconsole.log(scrapedData);\n}\n\nmodule.exports = GMapScrapper\n"]}