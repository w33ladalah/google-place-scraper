{"version":3,"sources":["../src/index.js"],"names":["EXTENSIONS","split","_logger","Logger","_filePaths","FilePaths","_ipcRenderer","electron","ipcRenderer","_puppeteerWrapper","PuppeteerWrapper","headless","width","height","main","console","log","on","e","preventDefault","searchQuery","val","searchLimit","parseInt","attr","GMapScrapper","cleanup","removeAttr","target","exportXlsx","send","document","getElementById","getPageData","url","page","goto","waitForSelector","shopName","$eval","name","textContent","reviewRating","rating","reviewCount","review","address","$$eval","divs","Array","from","map","div","innerText","find","undefined","timeout","ex","website","link","test","phone","latLong","getLatLong","returnObj","shop","trim","reviews","replace","latitude","longitude","getLinks","newScrollHeight","scrollHeight","divSelector","evaluate","querySelector","scrollTo","waitForTimeout","searchResults","querySelectorAll","el","href","filter","match","latLongStartIndex","indexOf","latLongEndIndex","latLongData","substring","loadWebViewPage","webview","loadURL","maxLinks","removeClass","addClass","text","newPage","gmapInitUrl","waitForNavigation","waitUntil","allLinks","linkCount","elements","some","push","getAttribute","click","length","scrapedData","html","no","data","empty","append","logError","logInfo","exportLogs","logsPath"],"mappings":"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","file":"index.js","sourcesContent":["//#region Imports\n// Library ----------------------------------------------------------------------------------\nimport electron from 'electron';\nimport { Logger } from './lib/logger';\nimport { FilePaths } from './lib/file-paths.js';\nimport { PuppeteerWrapper } from './lib/puppeteer-wrapper';\nimport $ from 'jquery';\nimport XLSX from 'xlsx';\n//#endregion\n\n//#region Setup - Dependency Injection-----------------------------------------------\nconst EXTENSIONS = \"xls|xlsx|xlsm|xlsb|xml|csv|txt|dif|sylk|slk|prn|ods|fods|htm|html\".split(\"|\");\nconst _logger = new Logger();\nconst _filePaths = new FilePaths(_logger, \"gmap-scrapper\");\nconst _ipcRenderer = electron.ipcRenderer;\nconst _puppeteerWrapper = new PuppeteerWrapper(_logger, _filePaths,\n\t{ headless: false, width: 800, height: 600 });\n\n//#endregion\n\n//#region Main ----------------------------------------------------------------------\n\nasync function main() {\n\tconsole.log(electron.ipcRenderer);\n\t$('#searchBtn').on('click', async (e) => {\n\t\te.preventDefault();\n\n\t\tconst searchQuery = $('input#searchBusiness').val();\n\t\tconst searchLimit = parseInt($('select#searchLimit').val());\n\n\t\t$('input#searchBusiness').attr('disabled', 'disabled');\n\t\t$('input#searchLimit').attr('disabled', 'disabled');\n\n\t\tawait GMapScrapper(searchQuery, searchLimit);\n\t});\n\n\t$('#stopBtn').on('click', async (e) => {\n\t\te.preventDefault();\n\n\t\tawait _puppeteerWrapper.cleanup();\n\n\t\t$('#searchBtn').removeAttr('disabled');\n\t\t$(e.target).attr('disabled', 'disabled');\n\t\t$('#restartBtn').attr('disabled', 'disabled');\n\n\t\t$('input#searchBusiness').removeAttr('disabled');\n\t\t$('input#searchLimit').removeAttr('disabled');\n\t});\n\n\t$('#restartBtn').on('click', async (e) => {\n\t\te.preventDefault();\n\n\t\tawait _puppeteerWrapper.cleanup();\n\n\t\tconst searchQuery = $('input#searchBusiness').val();\n\t\tconst searchLimit = parseInt($('select#searchLimit').val());\n\n\t\tawait GMapScrapper(searchQuery, searchLimit);\n\t});\n\n\t$('#exportBtn').on('click', async (e) => {\n\t\tawait exportXlsx();\n\t});\n}\n\nasync function exportXlsx() {\n\t// const HTMLOUT = document.getElementById('resultsTableContainer').outerHTML;\n\t_ipcRenderer.send('export-to-xlsx', await document.getElementById('resultsTableContainer'));\n};\n\nasync function getPageData(url, page) {\n\tawait page.goto(url);\n\n\t// await loadWebViewPage(url);\n\n\t//Shop Name\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-title span\");\n\tconst shopName = await page.$eval(\n\t\t\".x3AX1-LfntMc-header-title-title span\",\n\t\t(name) => name.textContent\n\t);\n\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-ij8cu-haAclf\");\n\tconst reviewRating = await page.$eval(\n\t\t\".x3AX1-LfntMc-header-title-ij8cu-haAclf span > span > span\",\n\t\t(rating) => rating.textContent\n\t);\n\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-ij8cu-haAclf\");\n\tconst reviewCount = await page.$eval(\n\t\t\".x3AX1-LfntMc-header-title-ij8cu-haAclf span button.widget-pane-link\",\n\t\t(review) => review.textContent\n\t);\n\n\t//Shop Address\n\tawait page.waitForSelector(\".QSFF4-text.gm2-body-2:nth-child(1)\");\n\tlet address = await page.$$eval(\n\t\t\"#pane > div > div > div > div > div > div > button > div > div > div\",\n\t\t(divs) =>\n\t\t\tArray.from(divs)\n\t\t\t\t.map((div) => div.innerText)\n\t\t\t\t.find((address) => address)\n\t);\n\n\tif (address === undefined) {\n\t\taddress = await page.$$eval(\n\t\t\t\"#pane > div > div > div > div > div > div > button > div > div > div\",\n\t\t\t(divs) => divs[1]\n\t\t);\n\t}\n\n\t//Website\n\ttry {\n\t\tawait page.waitForSelector(\".HY5zDd\", { timeout: 3 });\n\t} catch (ex) {\n\t\tconsole.log('No element found.');\n\t}\n\n\tconst website = await page.$$eval(\n\t\t\"#pane > div > div > div > div > div > div > button > div > div > div\",\n\t\t(divs) =>\n\t\t\tArray.from(divs)\n\t\t\t\t.map((div) => div.innerText)\n\t\t\t\t.find((link) =>\n\t\t\t\t\t/^((https?|ftp|smtp):\\/\\/)?(www.)?[a-z0-9]+(\\.[a-z]{2,}){1,3}(#?\\/?[a-zA-Z0-9#]+)*\\/?(\\?[a-zA-Z0-9-_]+=[a-zA-Z0-9-%]+&?)?$/.test(\n\t\t\t\t\t\tlink\n\t\t\t\t\t)\n\t\t\t\t)\n\t);\n\n\tconst phone = await page.$$eval(\n\t\t// \"#pane > div > div.widget-pane-content.cYB2Ge-oHo7ed > div > div > div:nth-child(9) > div:nth-child(2) > button > div.AeaXub > div.rogA2c > div.QSFF4-text.gm2-body-2\",\n\t\t'#pane > div > div.widget-pane-content.cYB2Ge-oHo7ed > div > div > div:nth-child(9) > div > button[data-item-id^=\"phone:tel:\"] div.QSFF4-text.gm2-body-2',\n\t\t(divs) =>\n\t\t\tArray.from(divs)\n\t\t\t\t.map((div) => div.innerText)\n\t\t\t\t.find((phone) => phone)\n\t);\n\n\tconst latLong = await getLatLong(url);\n\n\tlet returnObj = {\n\t\tshop: shopName.trim(),\n\t\trating: reviewRating === undefined ? '' : reviewRating.trim(),\n\t\treviews: reviewCount === undefined ? '' : reviewCount.trim(),\n\t\taddress: address === undefined ? '' : address.trim(),\n\t\twebsite: website === undefined ? '' : website.trim(),\n\t\tphone: phone === undefined ? '' : phone.trim().replace('-', ''),\n\t\tlatitude: latLong[0],\n\t\tlongitude: latLong[1],\n\t};\n\n\treturn returnObj;\n\t//await browser.close();\n}\n\n//Get Links\nasync function getLinks(page) {\n\t// Scrolling to bottom of page\n\tlet newScrollHeight = 0;\n\tlet scrollHeight = 1000;\n\tlet divSelector = \"#pane > div > div > div > div > div:nth-child(4) > div\";\n\n\twhile (true) {\n\t\tawait page.waitForSelector(divSelector);\n\n\t\tawait page.evaluate(\n\t\t\t(scrollHeight, divSelector) =>\n\t\t\t\tdocument.querySelector(divSelector).scrollTo(0, scrollHeight),\n\t\t\tscrollHeight,\n\t\t\tdivSelector\n\t\t);\n\n\t\tawait page.waitForTimeout(500);\n\n\t\tnewScrollHeight = await page.$eval(\n\t\t\tdivSelector,\n\t\t\t(div) => div.scrollHeight\n\t\t);\n\n\t\tif (scrollHeight === newScrollHeight) {\n\t\t\tbreak;\n\t\t} else {\n\t\t\tscrollHeight = newScrollHeight;\n\t\t}\n\t}\n\n\t// Get results\n\tconst searchResults = await page.evaluate(() =>\n\t\tArray.from(document.querySelectorAll(\"a\"))\n\t\t\t.map((el) => el.href)\n\t\t\t.filter(\n\t\t\t\t(link) =>\n\t\t\t\t\tlink.match(/https:\\/\\/www.google.com\\/maps\\//g, link) &&\n\t\t\t\t\t!link.match(/\\=https:\\/\\/www.google.com\\/maps\\//g, link)\n\t\t\t)\n\t);\n\n\treturn searchResults;\n}\n\nasync function getLatLong(url) {\n\tconst latLongStartIndex = url.indexOf('!3d-') + 4;\n\tconst latLongEndIndex = url.indexOf('?');\n\tconst latLongData = url.substring(latLongStartIndex, latLongEndIndex).replace('!4d', ':');\n\n\treturn latLongData.split(\":\");\n}\n\nasync function loadWebViewPage(url) {\n\tconst webview = document.getElementById('gmapWv');\n\tawait webview.loadURL(url);\n\t// webview.removeEventListener('dom-ready', loadWebViewPage);\n\t// webview.addEventListener('dom-ready', loadWebViewPage);\n}\n\nasync function GMapScrapper(searchQuery = \"toko bunga di bogor\", maxLinks = 100) {\n\tconsole.log('Start scrapping data.');\n\n\t$('#searchBtn').attr('disabled', 'disabled');\n\t$('#stopBtn').removeAttr('disabled');\n\t$('#restartBtn').removeAttr('disabled');\n\t$('#statusText span#statusTxt').removeClass('text-success').addClass('text-danger').text('Start scraping...');\n\n\tconst page = await _puppeteerWrapper.newPage();\n\n\tconst gmapInitUrl = \"https://www.google.com/maps/?q=\" + searchQuery;\n\n\tawait loadWebViewPage(gmapInitUrl);\n\n\tawait page.goto(gmapInitUrl);\n\tawait page.waitForNavigation({ waitUntil: \"domcontentloaded\" });\n\tawait page.waitForSelector('body');\n\n\tlet allLinks = [];\n\tlet linkCount = 0;\n\n\twhile (\n\t\t!(await page.$$eval(\n\t\t\t\"#pane > div > div > div > div > div > div > div\",\n\t\t\t(elements) =>\n\t\t\t\tArray.from(elements).some(\n\t\t\t\t\t(el) => (el.innerText === \"Tidak ditemukan hasil\" || el.innerText === \"No results found\")\n\t\t\t\t)\n\t\t))\n\t) {\n\t\tif (maxLinks !== 0 && linkCount > maxLinks) break;\n\n\t\tallLinks.push(...(await getLinks(page)));\n\n\t\tawait page.$$eval(\"button\", (elements) => {\n\t\t\treturn Array.from(elements)\n\t\t\t\t.find((el) => (el.getAttribute(\"aria-label\") === \"Halaman berikutnya\" || el.getAttribute(\"aria-label\") === \"Next page\"))\n\t\t\t\t.click()\n\t\t});\n\n\t\tawait page.waitForNavigation({ waitUntil: \"load\" });\n\n\t\tlinkCount = allLinks.length;\n\n\t\t$('#statusText span#statusTxt').removeClass('text-danger').addClass('text-warning').text('Gathering links...');\n\t\t$('#resultCountText').text(linkCount > maxLinks ? maxLinks : linkCount);\n\t}\n\n\tconst scrapedData = [];\n\n\t$('#resultsTable tbody').html('<tr><td class=\"text-center\" colspan=\"9\"><p>Data sedang diproses...</p></td></tr>');\n\n\tlet no = 1;\n\tfor (let link of allLinks) {\n\t\tif(maxLinks !== 0 && no > maxLinks) break;\n\n\t\t$('#statusText span#statusTxt').removeClass('text-warning').addClass('text-success').text('Processing \"'+link+'\"');\n\n\t\tconst data = await getPageData(link, page);\n\n\t\tif (no === 1) $('#resultsTable tbody').empty();\n\n\t\t$('#resultsTable tbody').append(`\n\t\t\t<tr>\n\t\t\t\t<th scope=\"row\">${no}</th>\n\t\t\t\t<td>${data.shop}</td>\n\t\t\t\t<td>${data.address}</td>\n\t\t\t\t<td>${data.phone}</td>\n\t\t\t\t<td>${data.website}</td>\n\t\t\t\t<td>${data.rating}</td>\n\t\t\t\t<td>${data.reviews}</td>\n\t\t\t\t<td>${data.latitude}</td>\n\t\t\t\t<td>${data.longitude}</td>\n\t\t\t</tr>\n\t\t`);\n\t\tscrapedData.push(data);\n\t\tno++;\n\t}\n\n\t$('#searchBtn').removeAttr('disabled');\n\t$('#stopBtn').attr('disabled', 'disabled');\n\t$('#restartBtn').attr('disabled', 'disabled');\n\n\t$('input#searchBusiness').removeAttr('disabled');\n\t$('input#searchLimit').removeAttr('disabled');\n\n\tawait _puppeteerWrapper.cleanup();\n\n\t$('#statusText span#statusTxt').removeClass('text-danger').addClass('text-success').text('Done!');\n}\n\n(async () => {\n\ttry {\n\t\t// const chromeSet = await _puppeteerWrapper.setup();\n\t\t// if (!chromeSet) {\n\t\t// \treturn;\n\t\t// }\n\n\t\tawait main();\n\t} catch (e) {\n\t\t_logger.logError('Thrown error:');\n\t\t_logger.logError(e);\n\t} finally {\n\t\tawait _puppeteerWrapper.cleanup();\n\t}\n\n\t_logger.logInfo('Done. Close window to exit');\n\n\tawait _logger.exportLogs(_filePaths.logsPath());\n})();\n\n//#endregion\n"]}