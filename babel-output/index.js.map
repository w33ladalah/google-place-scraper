{"version":3,"sources":["../src/index.js"],"names":["_setting","JSONdb","_logger","Logger","_filePaths","FilePaths","_ipcRenderer","electron","ipcRenderer","_puppeteerWrapper","PuppeteerWrapper","headless","width","height","scrapedData","main","_getSavedPath","text","get","on","e","preventDefault","searchQuery","val","searchLimit","parseInt","attr","GMapScrapper","cleanup","removeAttr","target","send","email","key","checkForLicense","licenseKey","baseUrl","checkForLicenseUrl","response","axios","licenseData","data","status","set","ex","console","log","getPageData","url","page","goto","waitForSelector","shopName","$eval","name","textContent","reviewRating","rating","reviewCount","review","address","$$eval","divs","Array","from","map","div","innerText","find","undefined","timeout","website","link","test","phone","latLong","getLatLong","returnObj","shop","trim","reviews","replace","latitude","longitude","getLinks","newScrollHeight","scrollHeight","divSelector","evaluate","document","querySelector","scrollTo","waitForTimeout","searchResults","querySelectorAll","el","href","filter","match","latLongStartIndex","indexOf","latLongEndIndex","latLongData","substring","split","loadWebViewPage","webview","getElementById","loadURL","maxLinks","removeClass","addClass","newPage","gmapInitUrl","waitForNavigation","waitUntil","allLinks","linkCount","elements","some","push","getAttribute","click","length","html","no","empty","append","event","arg","chromeSet","setup","_getDefaultOsPath","logError","logInfo","exportLogs","logsPath"],"mappings":"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","file":"index.js","sourcesContent":["//#region Imports\r\n// Library ----------------------------------------------------------------------------------\r\nimport electron from 'electron';\r\nimport { Logger } from './lib/logger';\r\nimport { FilePaths } from './lib/file-paths.js';\r\nimport { PuppeteerWrapper } from './lib/puppeteer-wrapper';\r\nimport $ from 'jquery';\r\nimport JSONdb from 'simple-json-db';\r\nimport axios from 'axios';\r\n//#endregion\r\n\r\n//#region Setup - Dependency Injection-----------------------------------------------\r\nconst _setting = new JSONdb('./settings.json');\r\nconst _logger = new Logger();\r\nconst _filePaths = new FilePaths(_logger, \"gmap-scrapper\");\r\nconst _ipcRenderer = electron.ipcRenderer;\r\nconst _puppeteerWrapper = new PuppeteerWrapper(_logger, _filePaths,\r\n\t{ headless: false, width: 800, height: 600 });\r\n\r\nlet scrapedData = [];\r\n//#endregion\r\n\r\n//#region Main ---------------------------------------------------------------------\r\n\r\nasync function main() {\r\n\tawait _puppeteerWrapper._getSavedPath();\r\n\r\n\t$('#licenseToText').text('Lisensi kepada: ' + _setting.get('user_email'));\r\n\r\n\t$('#searchBtn').on('click', async (e) => {\r\n\t\te.preventDefault();\r\n\r\n\t\tconst searchQuery = $('input#searchBusiness').val();\r\n\t\tconst searchLimit = parseInt($('select#searchLimit').val());\r\n\r\n\t\t$('input#searchBusiness').attr('disabled', 'disabled');\r\n\t\t$('input#searchLimit').attr('disabled', 'disabled');\r\n\r\n\t\tawait GMapScrapper(searchQuery, searchLimit);\r\n\t});\r\n\r\n\t$('#stopBtn').on('click', async (e) => {\r\n\t\te.preventDefault();\r\n\r\n\t\tawait _puppeteerWrapper.cleanup();\r\n\r\n\t\t$('#searchBtn').removeAttr('disabled');\r\n\t\t$(e.target).attr('disabled', 'disabled');\r\n\t\t$('#restartBtn').attr('disabled', 'disabled');\r\n\r\n\t\t$('input#searchBusiness').removeAttr('disabled');\r\n\t\t$('input#searchLimit').removeAttr('disabled');\r\n\t});\r\n\r\n\t$('#restartBtn').on('click', async (e) => {\r\n\t\te.preventDefault();\r\n\r\n\t\tawait _puppeteerWrapper.cleanup();\r\n\r\n\t\tconst searchQuery = $('input#searchBusiness').val();\r\n\t\tconst searchLimit = parseInt($('select#searchLimit').val());\r\n\r\n\t\tawait GMapScrapper(searchQuery, searchLimit);\r\n\t});\r\n\r\n\t$('#exportBtn').on('click', async (e) => {\r\n\t\t_ipcRenderer.send('export-to-xlsx', scrapedData);\r\n\t});\r\n\r\n\t$('#licenseForm').on('submit', async (e) => {\r\n\t\te.preventDefault();\r\n\t\tconst email = $('#emailAddress').val();\r\n\t\tconst key = $('#licenseKey').val();\r\n\r\n\t\tcheckForLicense(email, key);\r\n\t});\r\n}\r\n\r\nasync function checkForLicense(email, licenseKey) {\r\n\tconst baseUrl = _setting.get(\"license_server_url\") || 'https://license.pirantisofthouse.com';\r\n\tconst checkForLicenseUrl = `${baseUrl}/license-key/get?email=${email}&key=${licenseKey}`;\r\n\r\n\ttry {\r\n\t\tconst response = await axios.get(checkForLicenseUrl);\r\n\t\tconst licenseData = response.data;\r\n\t\tconst status = licenseData.status;\r\n\r\n\t\t_setting.set('user_email', email);\r\n\t\t_setting.set('user_license', licenseKey);\r\n\r\n\t\tif (status === 1)\r\n\t\t\t_ipcRenderer.send('license-updated', \"success\");\r\n\t\telse\r\n\t\t\t_ipcRenderer.send('license-updated', \"failed\");\r\n\t} catch (ex) {\r\n\t\tconsole.log(ex);\r\n    }\r\n}\r\n\r\nasync function getPageData(url, page) {\r\n\tawait page.goto(url);\r\n\r\n\t// await loadWebViewPage(url);\r\n\r\n\t//Shop Name\r\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-title span\");\r\n\tconst shopName = await page.$eval(\r\n\t\t\".x3AX1-LfntMc-header-title-title span\",\r\n\t\t(name) => name.textContent\r\n\t);\r\n\r\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-ij8cu-haAclf\");\r\n\tconst reviewRating = await page.$eval(\r\n\t\t\".x3AX1-LfntMc-header-title-ij8cu-haAclf span > span > span\",\r\n\t\t(rating) => rating.textContent\r\n\t);\r\n\r\n\tawait page.waitForSelector(\".x3AX1-LfntMc-header-title-ij8cu-haAclf\");\r\n\tconst reviewCount = await page.$eval(\r\n\t\t\".x3AX1-LfntMc-header-title-ij8cu-haAclf span button.widget-pane-link\",\r\n\t\t(review) => review.textContent\r\n\t);\r\n\r\n\t//Shop Address\r\n\tawait page.waitForSelector(\".QSFF4-text.gm2-body-2:nth-child(1)\");\r\n\tlet address = await page.$$eval(\r\n\t\t\"#pane > div > div > div > div > div > div > button > div > div > div\",\r\n\t\t(divs) =>\r\n\t\t\tArray.from(divs)\r\n\t\t\t\t.map((div) => div.innerText)\r\n\t\t\t\t.find((address) => address)\r\n\t);\r\n\r\n\tif (address === undefined) {\r\n\t\taddress = await page.$$eval(\r\n\t\t\t\"#pane > div > div > div > div > div > div > button > div > div > div\",\r\n\t\t\t(divs) => divs[1]\r\n\t\t);\r\n\t}\r\n\r\n\t//Website\r\n\ttry {\r\n\t\tawait page.waitForSelector(\".HY5zDd\", { timeout: 3 });\r\n\t} catch (ex) {\r\n\t\tconsole.log('No element found.');\r\n\t}\r\n\r\n\tconst website = await page.$$eval(\r\n\t\t\"#pane > div > div > div > div > div > div > button > div > div > div\",\r\n\t\t(divs) =>\r\n\t\t\tArray.from(divs)\r\n\t\t\t\t.map((div) => div.innerText)\r\n\t\t\t\t.find((link) =>\r\n\t\t\t\t\t/^((https?|ftp|smtp):\\/\\/)?(www.)?[a-z0-9]+(\\.[a-z]{2,}){1,3}(#?\\/?[a-zA-Z0-9#]+)*\\/?(\\?[a-zA-Z0-9-_]+=[a-zA-Z0-9-%]+&?)?$/.test(\r\n\t\t\t\t\t\tlink\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t);\r\n\r\n\tconst phone = await page.$$eval(\r\n\t\t// \"#pane > div > div.widget-pane-content.cYB2Ge-oHo7ed > div > div > div:nth-child(9) > div:nth-child(2) > button > div.AeaXub > div.rogA2c > div.QSFF4-text.gm2-body-2\",\r\n\t\t'#pane > div > div.widget-pane-content.cYB2Ge-oHo7ed > div > div > div:nth-child(9) > div > button[data-item-id^=\"phone:tel:\"] div.QSFF4-text.gm2-body-2',\r\n\t\t(divs) =>\r\n\t\t\tArray.from(divs)\r\n\t\t\t\t.map((div) => div.innerText)\r\n\t\t\t\t.find((phone) => phone)\r\n\t);\r\n\r\n\tconst latLong = await getLatLong(url);\r\n\r\n\tlet returnObj = {\r\n\t\tshop: shopName.trim(),\r\n\t\trating: reviewRating === undefined ? '' : reviewRating.trim(),\r\n\t\treviews: reviewCount === undefined ? '' : reviewCount.trim(),\r\n\t\taddress: address === undefined ? '' : address.trim(),\r\n\t\twebsite: website === undefined ? '' : website.trim(),\r\n\t\tphone: phone === undefined ? '' : phone.trim().replace(/\\-/g, ''),\r\n\t\tlatitude: latLong[0],\r\n\t\tlongitude: latLong[1],\r\n\t};\r\n\r\n\treturn returnObj;\r\n\t//await browser.close();\r\n}\r\n\r\n//Get Links\r\nasync function getLinks(page) {\r\n\t// Scrolling to bottom of page\r\n\tlet newScrollHeight = 0;\r\n\tlet scrollHeight = 1000;\r\n\tlet divSelector = \"#pane > div > div > div > div > div:nth-child(4) > div\";\r\n\r\n\twhile (true) {\r\n\t\tawait page.waitForSelector(divSelector);\r\n\r\n\t\tawait page.evaluate(\r\n\t\t\t(scrollHeight, divSelector) =>\r\n\t\t\t\tdocument.querySelector(divSelector).scrollTo(0, scrollHeight),\r\n\t\t\tscrollHeight,\r\n\t\t\tdivSelector\r\n\t\t);\r\n\r\n\t\tawait page.waitForTimeout(500);\r\n\r\n\t\tnewScrollHeight = await page.$eval(\r\n\t\t\tdivSelector,\r\n\t\t\t(div) => div.scrollHeight\r\n\t\t);\r\n\r\n\t\tif (scrollHeight === newScrollHeight) {\r\n\t\t\tbreak;\r\n\t\t} else {\r\n\t\t\tscrollHeight = newScrollHeight;\r\n\t\t}\r\n\t}\r\n\r\n\t// Get results\r\n\tconst searchResults = await page.evaluate(() =>\r\n\t\tArray.from(document.querySelectorAll(\"a\"))\r\n\t\t\t.map((el) => el.href)\r\n\t\t\t.filter(\r\n\t\t\t\t(link) =>\r\n\t\t\t\t\tlink.match(/https:\\/\\/www.google.com\\/maps\\//g, link) &&\r\n\t\t\t\t\t!link.match(/\\=https:\\/\\/www.google.com\\/maps\\//g, link)\r\n\t\t\t)\r\n\t);\r\n\r\n\treturn searchResults;\r\n}\r\n\r\nasync function getLatLong(url) {\r\n\tconst latLongStartIndex = url.indexOf('!3d-') + 4;\r\n\tconst latLongEndIndex = url.indexOf('?');\r\n\tconst latLongData = url.substring(latLongStartIndex, latLongEndIndex).replace('!4d', ':');\r\n\r\n\treturn latLongData.split(\":\");\r\n}\r\n\r\nasync function loadWebViewPage(url) {\r\n\tconst webview = document.getElementById('gmapWv');\r\n\tawait webview.loadURL(url);\r\n\t// webview.removeEventListener('dom-ready', loadWebViewPage);\r\n\t// webview.addEventListener('dom-ready', loadWebViewPage);\r\n}\r\n\r\nasync function GMapScrapper(searchQuery = \"toko bunga di bogor\", maxLinks = 100) {\r\n\tconsole.log('Start scrapping data.');\r\n\r\n\t// Make sure this variable empty\r\n\tscrapedData = [];\r\n\r\n\t$('#searchBtn').attr('disabled', 'disabled');\r\n\t$('#stopBtn').removeAttr('disabled');\r\n\t$('#restartBtn').removeAttr('disabled');\r\n\t$('#statusText span#statusTxt').removeClass('text-success').addClass('text-danger').text('Start scraping...');\r\n\r\n\tconst page = await _puppeteerWrapper.newPage();\r\n\r\n\tconst gmapInitUrl = \"https://www.google.com/maps/search/\" + searchQuery;\r\n\r\n\tawait loadWebViewPage(gmapInitUrl);\r\n\r\n\tawait page.goto(gmapInitUrl);\r\n\tawait page.waitForNavigation({ waitUntil: \"domcontentloaded\" });\r\n\tawait page.waitForSelector('body');\r\n\r\n\tlet allLinks = [];\r\n\tlet linkCount = 0;\r\n\r\n\twhile (\r\n\t\t!(await page.$$eval(\r\n\t\t\t\"#pane > div > div > div > div > div > div > div\",\r\n\t\t\t(elements) =>\r\n\t\t\t\tArray.from(elements).some(\r\n\t\t\t\t\t(el) => (el.innerText === \"Tidak ditemukan hasil\" || el.innerText === \"No results found\")\r\n\t\t\t\t)\r\n\t\t))\r\n\t) {\r\n\t\tif (maxLinks !== 0 && linkCount > maxLinks) break;\r\n\r\n\t\tallLinks.push(...(await getLinks(page)));\r\n\r\n\t\tawait page.$$eval(\"button\", (elements) => {\r\n\t\t\treturn Array.from(elements)\r\n\t\t\t\t.find((el) => (el.getAttribute(\"aria-label\") === \"Halaman berikutnya\" || el.getAttribute(\"aria-label\") === \"Next page\"))\r\n\t\t\t\t.click()\r\n\t\t});\r\n\r\n\t\tawait page.waitForNavigation({ waitUntil: \"load\" });\r\n\r\n\t\tlinkCount = allLinks.length;\r\n\r\n\t\t$('#statusText span#statusTxt').removeClass('text-danger').addClass('text-warning').text('Gathering links...');\r\n\t\t$('#resultCountText').text(linkCount > maxLinks ? maxLinks : linkCount);\r\n\t}\r\n\r\n\t$('#resultsTable tbody').html('<tr><td class=\"text-center\" colspan=\"9\"><p>Data sedang diproses...</p></td></tr>');\r\n\r\n\tlet no = 1;\r\n\tfor (let link of allLinks) {\r\n\t\tif(maxLinks !== 0 && no > maxLinks) break;\r\n\r\n\t\t$('#statusText span#statusTxt').removeClass('text-warning').addClass('text-success').text('Processing \"'+link+'\"');\r\n\r\n\t\tconst data = await getPageData(link, page);\r\n\r\n\t\tif (no === 1) $('#resultsTable tbody').empty();\r\n\r\n\t\t$('#resultsTable tbody').append(`\r\n\t\t\t<tr>\r\n\t\t\t\t<th scope=\"row\">${no}</th>\r\n\t\t\t\t<td>${data.shop}</td>\r\n\t\t\t\t<td>${data.address}</td>\r\n\t\t\t\t<td>${data.phone}</td>\r\n\t\t\t\t<td>${data.website}</td>\r\n\t\t\t\t<td>${data.rating}</td>\r\n\t\t\t\t<td>${data.reviews}</td>\r\n\t\t\t\t<td>${data.latitude}</td>\r\n\t\t\t\t<td>${data.longitude}</td>\r\n\t\t\t</tr>\r\n\t\t`);\r\n\t\tscrapedData.push(data);\r\n\t\tno++;\r\n\t}\r\n\r\n\t$('#searchBtn').removeAttr('disabled');\r\n\t$('#stopBtn').attr('disabled', 'disabled');\r\n\t$('#restartBtn').attr('disabled', 'disabled');\r\n\r\n\t$('input#searchBusiness').removeAttr('disabled');\r\n\t$('input#searchLimit').removeAttr('disabled');\r\n\r\n\tawait _puppeteerWrapper.cleanup();\r\n\r\n\t$('#statusText span#statusTxt').removeClass('text-danger').addClass('text-success').text('Done!');\r\n}\r\n\r\n_ipcRenderer.on('chrome-path-is-set', (event, arg) => {\r\n\t$('span#chromeInfo').addClass('text-success').text(arg);\r\n});\r\n\r\n(async () => {\r\n\ttry {\r\n\t\tconst chromeSet = await _puppeteerWrapper.setup();\r\n\t\tif (!chromeSet) {\r\n\t\t\t_ipcRenderer.send('chrome-not-found');\r\n\t\t} else {\r\n\t\t\t$('span#chromeInfo').addClass('text-success').text(await _puppeteerWrapper._getSavedPath() || await _puppeteerWrapper._getDefaultOsPath());\r\n        }\r\n\r\n\t\tawait main();\r\n\t} catch (e) {\r\n\t\t_logger.logError('Thrown error:');\r\n\t\t_logger.logError(e);\r\n\t} finally {\r\n\t\tawait _puppeteerWrapper.cleanup();\r\n\t}\r\n\r\n\t_logger.logInfo('Done. Close window to exit');\r\n\r\n\tawait _logger.exportLogs(_filePaths.logsPath());\r\n})();\r\n\r\n//#endregion\r\n"]}