{"version":3,"sources":["../../src/lib/puppeteer-wrapper.js"],"names":["PuppeteerWrapper","constructor","logger","filePaths","options","_logger","_filePaths","_options","headless","chromePath","undefined","browser","db","JSONdb","setup","isChromePathSet","_setChromePath","args","width","push","height","logInfo","puppeteer","launch","executablePath","cleanup","close","newPage","page","setUserAgent","_client","send","_getSavedPath","fs","existsSync","logError","_getDefaultOsPath","settingsPath","get","process","platform"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA;;;;;;;;AAQC;;;AAGM,MAAMA,gBAAN,CAAuB;AAC1BC,gBAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,OAA/B,EAAwC;AACpC,aAAKC,OAAL,GAAeH,MAAf;AACA,aAAKI,UAAL,GAAkBH,SAAlB;AACA,aAAKI,QAAL,GAAgBH,WAAW,EAAEI,UAAU,IAAZ,EAA3B;;AAEA;AACA,aAAKC,UAAL,GAAkBC,SAAlB;AACA,aAAKC,OAAL,GAAeD,SAAf;;AAEA,aAAKE,EAAL,GAAU,IAAIC,sBAAJ,CAAW,iBAAX,CAAV;AACH;;AAED;;AAEA,UAAMC,KAAN,GAAc;AACV,cAAMC,kBAAkB,MAAM,KAAKC,cAAL,EAA9B;AACA,YAAI,CAACD,eAAL,EAAsB;AAClB,mBAAO,KAAP;AACH;;AAED,cAAME,OAAO,EAAb;AACA,YAAI,KAAKV,QAAL,CAAcW,KAAlB,EAAyB;AACrBD,iBAAKE,IAAL,CAAW,iBAAgB,KAAKZ,QAAL,CAAcW,KAAM,IAAG,KAAKX,QAAL,CAAca,MAAO,EAAvE;AACH;;AAED,aAAKf,OAAL,CAAagB,OAAb,CAAqB,yBAArB;AACA,aAAKV,OAAL,GAAe,MAAMW,wBAAUC,MAAV,CAAiB;AAClCf,sBAAU,KAAKD,QAAL,CAAcC,QADU;AAElCgB,4BAAgB,KAAKf,UAFa;AAGlCQ;AAHkC,SAAjB,CAArB;AAKA,aAAKZ,OAAL,CAAagB,OAAb,CAAqB,uBAArB;AACA,eAAO,IAAP;AACH;;AAED,UAAMI,OAAN,GAAgB;AACZ,YAAI,KAAKd,OAAT,EAAkB,MAAM,KAAKA,OAAL,CAAae,KAAb,EAAN;AACrB;;AAED,UAAMC,OAAN,GAAgB;AACZ,cAAM,KAAKF,OAAL,EAAN;AACA,cAAM,KAAKX,KAAL,EAAN;;AAEA,cAAMc,OAAO,MAAM,KAAKjB,OAAL,CAAagB,OAAb,EAAnB;;AAEAC,aAAKC,YAAL,CAAkB,qHAAlB;;AAEA,YAAI,KAAKtB,QAAL,CAAcW,KAAlB,EAAyB;AACrB,kBAAMU,KAAKE,OAAL,CAAaC,IAAb,CAAkB,sCAAlB,CAAN;AACH;AACD,eAAOH,IAAP;AACH;;AAED;;AAEA;;AAEA,UAAMZ,cAAN,GAAuB;AACnB,aAAKP,UAAL,GAAkB,MAAM,KAAKuB,aAAL,EAAxB;;AAEA,YAAI,KAAKvB,UAAT,EAAqB;AACjB,gBAAIwB,aAAGC,UAAH,CAAc,KAAKzB,UAAnB,CAAJ,EAAoC,OAAO,IAAP;;AAEpC;AACA,iBAAKJ,OAAL,CAAa8B,QAAb,CAAuB,sCAAqC,KAAK1B,UAAW,EAA5E;AACH;;AAED;AACA,aAAKA,UAAL,GAAkB,KAAK2B,iBAAL,EAAlB;AACA,YAAI,CAACH,aAAGC,UAAH,CAAc,KAAKzB,UAAnB,CAAL,EAAqC;AACjC,iBAAKJ,OAAL,CAAa8B,QAAb,CAAuB,wCAAuC,KAAK1B,UAAW,EAA9E;AACA,iBAAKJ,OAAL,CAAa8B,QAAb,CAAuB,4CAA2C,KAAK7B,UAAL,CAAgB+B,YAAhB,EAA+B,EAAjG;AACA,mBAAO,KAAP;AACH;;AAED,eAAO,IAAP;AACH;;AAEDL,oBAAgB;AACZ,eAAO,KAAKpB,EAAL,CAAQ0B,GAAR,CAAY,aAAZ,CAAP;AACH;;AAEDF,wBAAoB;AAChB,YAAIG,QAAQC,QAAR,KAAqB,OAAzB,EAAkC;AAC9B,mBAAO,kEAAP;AACH,SAFD,MAEO;AACH,mBAAO,wBAAP;AACH;AACJ;;AAED;AA3F0B;QAAjBxC,gB,GAAAA,gB","file":"puppeteer-wrapper.js","sourcesContent":["import puppeteer from 'puppeteer-core';\nimport fs from 'fs';\nimport JSONdb from 'simple-json-db';\r\n\n/**\n * chromePath:  the path of the chrome executable in our pc\n * setup() :    initialize Puppeteer\n * cleanup():   clearnup Puppeteer\n * browser:     global Puppeteer browser instance\n * newPage():   get new page with default user agent and dimensions\n */\n\n /**\n  * options: {headless, width, height}\n  */\nexport class PuppeteerWrapper {\n    constructor(logger, filePaths, options) {\n        this._logger = logger;\n        this._filePaths = filePaths;\n        this._options = options || { headless: true };\n\n        // Public\n        this.chromePath = undefined;\n        this.browser = undefined;\n\n        this.db = new JSONdb('./settings.json');\n    }\n\n    //#region Public API setup - cleanup\n\n    async setup() {\n        const isChromePathSet = await this._setChromePath();\n        if (!isChromePathSet) {\n            return false;\n        }\n\n        const args = [];\n        if (this._options.width) {\n            args.push(`--window-size=${this._options.width},${this._options.height}`);\n        }\n\n        this._logger.logInfo(\"Setting up puppeteer...\");\n        this.browser = await puppeteer.launch({\n            headless: this._options.headless,\n            executablePath: this.chromePath,\n            args\n        });\n        this._logger.logInfo(\"Puppeteer initialized\");\n        return true;\n    }\n\n    async cleanup() {\n        if (this.browser) await this.browser.close();\n    }\n\n    async newPage() {\n        await this.cleanup();\n        await this.setup();\n\n        const page = await this.browser.newPage();\n\n        page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36');\n\n        if (this._options.width) {\n            await page._client.send('Emulation.clearDeviceMetricsOverride');\n        }\n        return page;\n    }\n\n    //#endregion\n\n    //#region Helpers\n\n    async _setChromePath() {\n        this.chromePath = await this._getSavedPath();\n\n        if (this.chromePath) {\n            if (fs.existsSync(this.chromePath)) return true;\n\n            // The saved path does not exists\n            this._logger.logError(`Saved Chrome path does not exists: ${this.chromePath}`);\n        }\n\n        // Try the default path\n        this.chromePath = this._getDefaultOsPath();\n        if (!fs.existsSync(this.chromePath)) {\n            this._logger.logError(`Default chrome path does not exists: ${this.chromePath}`);\n            this._logger.logError(`Try to set chrome path in settings file: ${this._filePaths.settingsPath()}`);\n            return false;\n        }\n\n        return true;\n    }\n\n    _getSavedPath() {\n        return this.db.get('chrome_path');\n    }\n\n    _getDefaultOsPath() {\n        if (process.platform === \"win32\") {\n            return 'C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe';\n        } else {\n            return '/usr/bin/google-chrome';\n        }\n    }\n\n    //#endregion\n}\n"]}